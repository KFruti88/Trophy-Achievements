name: Sync PSN Feeds
on:
  schedule:
    - cron: '0 * * * *' # Runs every hour
  workflow_dispatch: # Allows you to run it manually

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Fetch and Combine Feeds
        run: |
          # List of your gamer feeds
          FEEDS=("https://psntrophyleaders.com/user/view/OneLIVIDMAN/rss" "https://psntrophyleaders.com/user/view/joe-punk_/rss" "https://psntrophyleaders.com/user/view/Werewolf_5386/rss" "https://psntrophyleaders.com/user/view/DarkTerrdog/rss")
          
          echo '<?xml version="1.0" encoding="UTF-8" ?><rss version="2.0"><channel><title>Combined PSN Feeds</title>' > feed.xml
          
          for url in "${FEEDS[@]}"; do
            curl -s "$url" | sed -n '/<item>/,/<\/item>/p' >> feed.xml
          done
          
          echo '</channel></rss>' >> feed.xml

      - name: Generate HTML for Website
        run: |
          # Simple Python script to turn XML into a clean HTML Card
          python3 -c "
          import xml.etree.ElementTree as ET
          import html
          
          try:
              tree = ET.parse('feed.xml')
              root = tree.getroot()
              items = root.findall('.//item')[:10] # Show last 10 trophies
              
              with open('feed_widget.html', 'w') as f:
                  f.write('<div id=\"psn-trophy-widget\" style=\"font-family: Arial, sans-serif; border: 1px solid #ccc; border-radius: 8px; width: 90%; margin: auto; padding: 15px; background: #f9f9f9;\">')
                  f.write('<h3 style=\"margin-top:0; color: #00439c;\">Latest PSN Activity</h3><ul style=\"list-style: none; padding: 0;\">')
                  
                  for item in items:
                      title = item.find('title').text if item.find('title') is not None else 'Unknown Trophy'
                      link = item.find('link').text if item.find('link') is not None else '#'
                      f.write(f'<li style=\"margin-bottom: 10px; border-bottom: 1px solid #eee; padding-bottom: 5px;\">')
                      f.write(f'<a href=\"{link}\" target=\"_blank\" style=\"text-decoration: none; color: #333; font-weight: bold;\">{title}</a>')
                      f.write(f'</li>')
                  
                  f.write('</ul></div>')
          except Exception as e:
              print(f'Error: {e}')
          "

      - name: Commit and Push
        run: |
          git config --global user.name "GitHub Actions"
          git config --global user.email "actions@github.com"
          git add feed.xml feed_widget.html
          git commit -m "Update PSN Feeds" || exit 0
          git push
